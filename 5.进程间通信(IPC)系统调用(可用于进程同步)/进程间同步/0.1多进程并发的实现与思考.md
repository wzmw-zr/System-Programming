# 多进程并发的实现与思考

多进程并发意味这**主进程循环创建子进程，==子进程创建了就跳出循环==，创建了所有子进程之后，主进程循环等待回收退出的子进程的资源。**



## 一、批量创建进程的实现

实现多进程并发，创建多个进程时，**==在主进程中使用for循环创建子进程，这个就是批量创建，创建好之后，需要判断是子进程还是主进程，如果是子进程的话需要break跳出循环，子进程必须跳出循环，因为循环是只有父进程才能进行的，子进程不跳出就会造成子进程又创建子进程，很快就会耗尽资源==，可以避免主进程创建就等待的顺序执行。**

代码例子如下：

```c
for (int i = 1; i <= ins; i++) {
    if ((pid = fork()) < 0) {
        perror("fork");
        return 1;
    } else if (pid == 0) {
        // 批量创建子进程的循环中，判断是子进程之后需要跳出循环，这样才可以真正实现并发
        //子进程一定要跳出循环，因为在循环中，否则会导致子进程也在执行循环，很快就会耗尽资源
        x = i;
        break;
    }
}
// 判断是子进程，执行子进程的操作
if (pid == 0) {
    do_add(max, x);
    exit(0);
}
```



## 二、批量创建进程，主进程的工作

批量创建进程时，**主进程的工作是等待并回收子进程的资源。**

**进程与线程不一样，线程可以设置分离状态，系统自动回收资源，==进程是必须要人为使用一个进程来回收资源的。==**

在多进程并发时，住进程循环等待并回收子进程的资源，其代码简要如下：

```c
while (ins) {
    wait(NULL);
    ins--;
}
```

