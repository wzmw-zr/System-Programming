# 直接IO与自缓存应用程序

## 一、直接IO：绕过内核缓冲区高速缓存

使用直接IO方式传输数据，**数据是==直接在用户地址空间的缓冲区和磁盘之间直接传输==，完全不需要内核缓冲区(页缓存)的支持。**

操作系统层提供的缓存往往会使应用程序在读写数据的时候获得更好的性能，但是对于某些特殊的应用程序，比如说数据库管理系统这类应用，他们更倾向于选择他们自己的缓存机制，因为数据库管理系统往往比操作系统更了解数据库中存放的数据，数据库管理系统可以提供一种更加有效的缓存机制来提高数据库中数据的存取性能。



## 二、自缓存应用程序(self-caching applications)

**自缓存应用程序有自己的数据缓存机制，它会将数据缓存在应用程序地址空间，这类应用程序完全不需要使用操作系统内核的高速缓冲。**

**对于自缓存应用程序而言，缓存IO会降低效率，==直接IO技术非常适合自缓存应用程序。==**



## 三、设置直接IO

在`open`系统调用中加上`O_DIRECT`标志即可。



## 四、直接IO的特点

### 1.直接 I/O 的优点

直接 I/O 最主要的优点就是**通过减少操作系统内核缓冲区和应用程序地址空间的数据拷贝次数，降低了对文件读取和写入时所带来的 CPU 的使用以及内存带宽的占用**。

### 2.直接 I/O 潜在可能存在的问题

直接 I/O 并不一定总能提供令人满意的性能上的飞跃。设置直接 I/O 的开销非常大，而直接 I/O 又不能提供缓存 I/O 的优势。

**只有在确定了设置缓冲 I/O 的开销非常巨大的情况下，才考虑使用直接 I/O。**