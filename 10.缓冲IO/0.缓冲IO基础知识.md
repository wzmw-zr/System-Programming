# 缓冲IO基础知识

## 一、缓冲IO的三种机制

1. non-buffered：无缓冲
2. block-buffered：块缓冲 (全缓冲)
3. line-buffered：行缓冲

```
The  three  types  of  buffering  available  are  unbuffered,  block
buffered, and line buffered.
```

**这三个是用户空间的缓冲机制。**

块是文件操作的基本单位。

block-bufferd的目的是进行块对齐。减少块空间的浪费。

系统的1块的大小是512字节的整数倍。

```bash
dd if=/dev/zero of=./a bs=4096 count=512
```

通过上面的命令，如果读一个字符就写一次磁盘，那么IO次数非常多，效率就会非常低。

一旦使用了缓冲，那么效率就会非常高，因为这减少IO的次数。

行缓冲通常用于行缓冲。

所有的文件操作默认都是块缓冲。

标准错误是无缓冲。



标准IO使用双拷贝：用户空间-》内核空间-》文件，文件-》内核空间-》用户空间

这种双拷贝实际上造成了性能的浪费

**内核的回写机制：等待足够多数据     或者    延时**

内核空间使用回写机制进行了内核空间的缓冲，内核空间会使用 **最近最少使用算法和局部性原理(进行预读)**来进行IO。



直接IO，同步IO，异步IO

零拷贝技术

**终端有与用户交互的缓冲，我们每一次在终端中的输入实际上都是有在终端中进行缓冲的，在终端中调用其他程序，实际上是使用了一个`popen()`，这样我们在终端中进行输入时，一开始我们键入的数据是在终端缓冲区中的，之后被调用的程序会从管道中读取到这些数据。**

