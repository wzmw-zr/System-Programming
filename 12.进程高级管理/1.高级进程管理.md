# 高级进程管理

## 一、进程调度

+ 进程调度是一个内核子系统。
+ 进程调度的主要任务是决定哪一个“就绪状态”的进程来执行。
+ 就绪进程是非阻塞进程。
+ 阻塞进程就是正在睡眠的进程，需要内核唤醒的进程 (缺少时间片之外的资源的进程)。

进程调度需要考虑到三态模型、五态模型等进程状态模型。



## 二、单任务操作系统到多任务操作系统

+ DOS是单任务操作系统，每次只运行一个进程。
+ 现在已经都是多任务操作系统。
+ 在单处理器的操作系统中，进程交错进行。
+ 在多处理器操作系统中，同一时刻在不同的的处理器上可以运行不同的任务，达到真正的并行。

> 并发与并行的区别：并发是宏观的概念，并行是微观的概念



## 三、进程调度方式—协同式与抢占式

**协同式调度**：

+ 进程会一直执行到它运行结束，操作系统不做任何干预。

**抢占式调度**：

+ 调度器决定进程何时结束并执行另一个进程，这叫抢占。
+ 进程被抢占前运行的时间被称为该进程的时间片。
+ **调度器给每个进程分配一个处理器时间片。**

**目前主流的进程调度方式是抢占式。**

抢占式调度优先调度高优先级的进程。

**进程的创建与终止就是进入和退出就绪队列。**



## 四、时间片

时间片的长短会对系统的全局性行为和性能来说是至关重要的。

**时间片过长**：可以提升系统吞吐率和全局性能。但是降低了并发运行，用户会感觉到明显的延迟。

**时间片过短：**可以提升交互性能，但是大量的时间将花费在调度上，时间局部性带来的性能提升将大打折扣，缓存没有建立起来进程就被调度走了。

解决时间片长短问题：**不用时间片，但是我们无法做到不用时间片。**



## 五、IO密集型和处理器密集型

+ 一直消耗完可用时间片的进程被称为处理器密集型进程(处理器约束型进程);
  + 需要获取大量的CPU资源
  + 消耗掉调度器分配的全部CPU
  + 期望获得**更长的时间片，从而最大化缓存命中，尽快完成任务(时间局部性)**
+ 多数时间处于阻塞状态或的进程称为IO密集型进程(IO约束型进程)：
  + 经常阻塞在文件IO操作上：文件、网络、键盘、鼠标(**实际上都是文件**)
  + 也可能除了请求内核执行IO操作之外什么也不做
  + 进程运行时间短，然后阻塞在内核资源，在阻塞之后，唤醒要快，即资源准备要快，**调度快那么运行就感觉流畅，换句话说，IO密集型要求时间片要短。**



## 六、完全公平调度器(compeletely fair scheduler, CFS)

**CFS实现了内核层面上的去时间片**，Linux现在的内核就是使用这种算法，**但是CPU还是有时间片的。**

+ CFS给N个进程分别分配$\frac{1}{N}$的处理器时间。

+ 然后通过设置优先级和权值调整分配，默认优先级是0,权值为1。

+ **优先级设置越小(优先级越高)，则权值越大，分配的比例也增加。**

+ **引入目标延迟，目标延迟是调度的固定周期，即进程调度的周期**，用来确定每个进程的真实的执行时间。

+ 为了避免因为目标延迟设置过小导致每个进程运行的时间过短：**引入最小粒度。**

  有了最小粒度，就可以保证时间局部性。

+ **公平性：每个进程都会得到处理器资源的“公平配额”。**