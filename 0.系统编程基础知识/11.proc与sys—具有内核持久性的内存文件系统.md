# ` /proc` ,`/sys`具有内核持久性的文件系统

## 一、`/dev`,`/proc`,`/sys`文件系统的用途

### 1.`/dev`文件树的作用

`/dev`文件树包含了设备节点，**给用户空间提供了对内核的设备驱动程序的访问方式。**

所有`POSIX`类型的操作系统都有`/dev`树。

在`/dev`文件树中有对**虚拟设备与物理设备的设备驱动程序**，通过这些文件可以与正在运行的驱动程序进行通信。



### 2.`/proc`文件系统的作用

`/proc`文件系统开始转向**纯净的==“进程文件系统”==**，原本`/proc`文件系统中是有很多与内核中与进程无关的信息的，现在很多已经转到了`/sys`文件系统中。

`/proc`文件系统是一种内存文件系统，具有内核持久性。

现在在`/proc`文件系统中可以找到的东西有：**进程的相关信息，系统运行的部分情况等等。**

关于系统硬件与设备的详细信息需要到`/sys`文件系统中去查看。



### 3.`/sys`文件系统的作用

`/sys`文件系统往往比`/proc`文件系统更为严格地组织，因为**`/sys`反映了内核中用于管理系统资源的数据结构。**

在`/sys`文件系统包括了所有设备的对象(**包==含真实设备与虚拟设备==**)，我们**可以通过对`/sys`文件系统的访问获得对应设备的信息。**



## 二、`/sys`文件系统的目录结构

主要介绍`/sys`文件系统，下面是`/sys`文件系统中的比较重要与常用的目录。

+ `/sys/devices`：这是**内核对系统中所有设备的分层次表达模型**，也是`/sys`文件系统管理设备最重要的目录结构。
+ `/sys/dev`：该目录下维护一个**按字符设备和块设备的主次号码链接到真实的设备(`/sys/devices`下)的符号链接文件。**
+ `/sys/bus`：这是**内核设备按照总线类型分层放置的目录结构**，devices中的所有设备都是连接于某种总线之下，这里每一种具体总线之下都可以找到没一个具体的设备的符号链接，它也是构成Linux统一设备模型的一部分。
+ `/sys/class`：这是**按照设备功能分类的设备模型**，不论它们是以何种总线连接到系统。这也是构成Linux统一设备模型的一部分。





## 三、`/sys`文件系统与Linux统一设备模型

Linux统一模型的目的是为了**对计算机上的所有设备进行统一地表示和操作，包括设备本身和设备之间的连接关系。**

这个模型是在分析了 `PCI` 和 `USB` 的总线驱动过程中得到的，这两个总线类型能代表当前系统中的大多数设备类型，它们都有完善的热插拔机制和电源管理的支持，也都有级连机制的支持，以桥接的 `PCI/USB` 总线控制器的方式可以支持更多的` PCI/USB` 设备。**为了给所有设备添加统一的电源管理的支持，而不是让每个设备中去独立实现电源管理的支持，人们考虑的是如何尽可能地重用代码；**而且**在有层次模型的 `PCI/USB` 总线中，必须以合理形式展示出这个层次关系，这也是==电源管理等所要求的必须有层次结构==。**

下面是Linux统一设备模型的基本结构：

| 类型                      | 所包含内容                                             | 内核数据结构           |
| ------------------------- | ------------------------------------------------------ | ---------------------- |
| 设备(Devices)             | 设备是此模型中最基本的类型，以设备本身的连接按层次组织 | `struct device`        |
| 设备驱动(Devices Driver)  | 在一个系统中安装多个相同设备，只需要一份驱动程序的支持 | `struct device_driver` |
| 总线类型(Bus Types)       | 在整个总线级别对此总线上连接的所有设备进行管理         | `struct bud_type`      |
| 设备类别(Devices Classes) | 按照功能进行分类组织的设备层次树                       | `struct class`         |

从内核实现它们所使用的数据结构来说，**Linux统一设备模型又是以两种基本数据结构进行树型和链表型结构组织的：**

+ `kobject`:在**Linux设备模型中最基本的对象**，其功能提供引用计数和维持父子(parent)结构，平级(sibling)目录关系，上面的 device, device_driver 等各对象都是以 `kobject `基础功能之上实现的；
+ `kset`：用来**对同类型对象提供一个包装集合**，在内核数据结构上它也是由内嵌一个 `kbojec`t 实现，因而它同时也是一个 `kobject `(面向对象` OOP `概念中的继承关系) ，具有 `kobject` 的全部功能



那么，`/sys` 目录结构就是非常清晰明了:

+ 在 `/sys` 根目录之下的都是` kset`，它们组织了` /sys `的顶层目录视图；
+ 在部分 `kset `下有二级或更深层次的` kset`；
+ 每个` kset` 目录下再包含着一个或多个` kobject`，这表示一个集合所包含的` kobject` 结构体；
+ 在 `kobject` 下有**属性(`attrs`)文件和属性组(`attr_group`)**，**属性组就是组织属性的一个目录**，它们一起**==向用户层提供了表示和操作这个 `kobject` 的属性特征的接口==**；
+ 在` kobject `下还有一些符号链接文件，指向其它的` kobject`，这些符号链接文件用于组织上面所说的 device, driver, bus_type, class, module 之间的关系；
+ 不同类型如设备类型的、设备驱动类型的 `kobject` 都有不同的属性，不同驱动程序支持的 `sysfs` 接口也有不同的属性文件；而相同类型的设备上有很多相同的属性文件；